# DATA Project - Cursor Rules

## David's Working Style

### 1. Slow Down and Understand First
- **DO NOT** rush into implementation without full context
- **DO** read and understand the codebase before proposing changes
- **DO** ask clarifying questions when requirements are unclear
- When David says "plan mode" - that means READ ONLY until he approves action

### 2. Validate Before Moving Forward
- Test what you build before claiming it's complete
- A feature is NOT done until it's been validated with real data
- Don't rush to the next phase until the current phase is proven stable
- "Infrastructure built" ≠ "Infrastructure validated"

### 3. Don't Force Things
> "You HAVE to stop forcing things, let the app fail until it passes!"

- Let errors surface naturally - don't work around them
- If something fails, diagnose the root cause
- Don't add band-aid fixes that mask underlying issues
- When debugging, check server logs, not just client errors

### 4. Decision Checkpoints for Critical Changes
**Always ask before implementing:**
- Anything that touches LLM prompts or behavior
- UI/UX changes (present plans for approval first)
- Data model changes
- Sync behavior decisions
- Changes to DATA's personality or responses

**Present options clearly:**
```
Option A: [description] - Pros/Cons
Option B: [description] - Pros/Cons
Recommendation: [your suggestion]
What would you prefer?
```

### 5. Risk-Based Approach
| Risk Level | Examples | Approach |
|------------|----------|----------|
| Low | Bug fixes, UI tweaks | Implement, test, commit |
| Medium | New features, sync logic | Discuss design, implement incrementally, validate |
| High | LLM changes, data migrations | Full plan review, quality gates, user validation at each step |

### 6. Commit Discipline
- Commit at logical checkpoints (not just at the end)
- Descriptive commit messages with context
- Push to feature branch frequently
- Create documentation for pickup plans when stopping mid-work

### 7. Production Safety
- This project uses isolated feature branches
- Never push directly to main/develop without approval
- Test in local environment before any deployment discussion
- Preserve the ability to rollback

---

## Project-Specific Knowledge

### Architecture
```
projects/
├── daily-task-assistant/     # FastAPI backend (Python)
│   ├── api/main.py           # All API endpoints
│   ├── daily_task_assistant/ # Core modules
│   │   ├── task_store/       # Firestore task CRUD
│   │   ├── sync/             # SS↔FS sync service
│   │   ├── llm/              # Anthropic integration
│   │   └── smartsheet_client.py
│   └── config/smartsheet.yml # Column IDs, picklists
│
└── web-dashboard/            # React + Vite frontend
    └── src/
        ├── App.tsx
        ├── api.ts            # Backend API client
        └── components/
```

### Key Concepts
- **Three-Date Model**: `planned_date` (when you'll do it), `target_date` (original goal), `hard_deadline` (must complete by)
- **FSID**: Bidirectional linking field - Firestore ID stored in Smartsheet for duplicate prevention
- **Domains**: `personal`, `church` (both in personal sheet), `work` (separate sheet)
- **Sync Status**: `synced`, `pending`, `local_only`, `conflict`

### Data Flow
```
Smartsheet ←→ SyncService ←→ Firestore ←→ UI
                  ↓
            DATA (LLM) reads from Firestore (after Phase 2)
```

### Common Commands
```powershell
# Backend server
cd projects/daily-task-assistant
$env:PYTHONPATH = "."; $env:DTA_DEV_AUTH_BYPASS = "1"
python -m uvicorn api.main:app --host 0.0.0.0 --port 8000

# Frontend server
cd projects/web-dashboard
npm run dev

# Trigger sync
Invoke-RestMethod -Uri "http://localhost:8000/sync/now" -Method POST `
  -Headers @{"X-User-Email"="david.a.royes@gmail.com"; "Content-Type"="application/json"} `
  -Body '{"direction": "bidirectional"}'
```

### Files to Know
| File | Purpose |
|------|---------|
| `DATA_PREFERENCES.md` | DATA's behavioral guidelines |
| `config/smartsheet.yml` | Column IDs and validation rules |
| `task_store/store.py` | FirestoreTask dataclass + CRUD |
| `sync/service.py` | Bidirectional sync logic |
| `docs/Phase2_Pickup_Plan.md` | Current work plan |

---

## Anti-Patterns (Don't Do These)

### ❌ Making assumptions about what David wants
Always ask. Especially for:
- UI layout decisions
- Workflow changes
- How features should behave

### ❌ Rushing to the "next phase"
Current phase must be validated before moving on.

### ❌ Implementing LLM changes without discussion
LLM-touching changes are medium/high risk. Always present options first.

### ❌ Over-engineering
Don't add features that weren't requested. Keep solutions simple.

### ❌ Ignoring test failures
If a test fails, fix it. Don't skip tests or work around them.

### ❌ Long code blocks without explanation
Explain what you're doing and why before showing code.

---

## Communication Style

### When starting a session:
1. Review any pickup plan docs
2. Summarize current state
3. Ask what David wants to focus on

### When proposing changes:
1. Explain the problem/goal
2. Present options (if multiple approaches)
3. Wait for approval before implementing

### When encountering errors:
1. Show the actual error
2. Explain what it means
3. Propose a fix
4. Don't just retry the same thing

### When finishing work:
1. Summarize what was done
2. Note what's left to do
3. Commit and push changes
4. Update documentation if stopping mid-work

---

## Current Project Status (Update as needed)

**Branch:** `feature/unified-tasks`

**Phase 1 - Sync Infrastructure:** Built, needs validation
- [ ] FSID duplicate prevention - needs testing
- [ ] Bidirectional sync - needs thorough testing
- [ ] Work sheet integration - not started
- [ ] Recurring items behavior - needs definition
- [ ] UI improvements - needs discussion
- [ ] Sync automation - not started

**Phase 2 - LLM Integration:** NOT STARTED (wait for Phase 1 stability)

**See:** `docs/Phase2_Pickup_Plan.md` for detailed checklist
